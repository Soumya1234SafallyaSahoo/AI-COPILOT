<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Echo Bot V2 (Murf Voice)</title>
    <style>
        body {
            background-color: #003153; /* Prussian Blue */
            font-family: Arial, sans-serif;
            color: white;
            padding: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        h1 {
            color: white; /* Heading color */
        }
    </style>
</head>

<body>
    <h1>üéôÔ∏è Echo Bot V2</h1>

    <button id="startBtn">Start Recording</button>
    <button id="stopBtn">Stop Recording</button>

    <p id="status">Status: Not started</p>

    <h3>Transcription:</h3>
    <p id="transcript">Waiting for input...</p>

    <h3>Echoed Murf Audio:</h3>
    <div id="audioContainer"></div>

    <script>
        let mediaRecorder;
        let audioChunks = [];

        document.getElementById("startBtn").onclick = function () {
            navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.start();
                audioChunks = [];

                document.getElementById("status").innerText = "Recording...";

                mediaRecorder.ondataavailable = function (e) {
                    audioChunks.push(e.data);
                };

                mediaRecorder.onstop = function () {
                    const blob = new Blob(audioChunks, { type: 'audio/wav' });
                    sendToEchoEndpoint(blob);
                };
            });
        };

        document.getElementById("stopBtn").onclick = function () {
            if (mediaRecorder && mediaRecorder.state !== "inactive") {
                mediaRecorder.stop();
                document.getElementById("status").innerText = "Stopped. Sending to echo...";
            }
        };

        function sendToEchoEndpoint(blob) {
            const status = document.getElementById("status");
            const transcriptDisplay = document.getElementById("transcript");
            const audioContainer = document.getElementById("audioContainer");

            const formData = new FormData();
            formData.append("file", blob, "recording.wav");

            fetch("http://127.0.0.1:8000/tts/echo", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.audio_url) {
                    status.innerText = "Murf audio generated ‚úÖ";
                    transcriptDisplay.innerText = "Your voice has been echoed by AI!";

                    const audioElement = document.createElement("audio");
                    audioElement.controls = true;
                    audioElement.src = data.audio_url;

                    audioContainer.innerHTML = "";
                    audioContainer.appendChild(audioElement);
                    audioElement.play();
                } else {
                    status.innerText = "Error: Murf audio not received!";
                    transcriptDisplay.innerText = "Transcription failed or Murf error.";
                }
            })
            .catch(err => {
                console.error(err);
                status.innerText = "Echo failed!";
                transcriptDisplay.innerText = "Something went wrong!";
            });
        }
    </script>
</body>
</html>
